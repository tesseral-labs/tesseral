// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.27.0
// source: queries-common.sql

package queries

import (
	"context"

	"github.com/google/uuid"
)

const bumpSessionLastActiveTime = `-- name: BumpSessionLastActiveTime :exec
UPDATE
    sessions
SET
    last_active_time = now()
WHERE
    id = $1
`

func (q *Queries) BumpSessionLastActiveTime(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, bumpSessionLastActiveTime, id)
	return err
}

const getCurrentSessionSigningKeyByProjectID = `-- name: GetCurrentSessionSigningKeyByProjectID :one
SELECT
    id, project_id, public_key, private_key_cipher_text, create_time, expire_time
FROM
    session_signing_keys
WHERE
    project_id = $1
ORDER BY
    create_time DESC
LIMIT 1
`

func (q *Queries) GetCurrentSessionSigningKeyByProjectID(ctx context.Context, projectID uuid.UUID) (SessionSigningKey, error) {
	row := q.db.QueryRow(ctx, getCurrentSessionSigningKeyByProjectID, projectID)
	var i SessionSigningKey
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.PublicKey,
		&i.PrivateKeyCipherText,
		&i.CreateTime,
		&i.ExpireTime,
	)
	return i, err
}

const getImpersonatorUserByID = `-- name: GetImpersonatorUserByID :one
SELECT
    id,
    email
FROM
    users
WHERE
    id = $1
`

type GetImpersonatorUserByIDRow struct {
	ID    uuid.UUID
	Email string
}

func (q *Queries) GetImpersonatorUserByID(ctx context.Context, id uuid.UUID) (GetImpersonatorUserByIDRow, error) {
	row := q.db.QueryRow(ctx, getImpersonatorUserByID, id)
	var i GetImpersonatorUserByIDRow
	err := row.Scan(&i.ID, &i.Email)
	return i, err
}

const getProjectIDByVaultDomain = `-- name: GetProjectIDByVaultDomain :one
SELECT
    id
FROM
    projects
WHERE
    vault_domain = $1
`

func (q *Queries) GetProjectIDByVaultDomain(ctx context.Context, vaultDomain string) (uuid.UUID, error) {
	row := q.db.QueryRow(ctx, getProjectIDByVaultDomain, vaultDomain)
	var id uuid.UUID
	err := row.Scan(&id)
	return id, err
}

const getProjectTrustedDomains = `-- name: GetProjectTrustedDomains :many
SELECT
    project_trusted_domains.domain
FROM
    project_trusted_domains
WHERE
    project_id = $1
`

func (q *Queries) GetProjectTrustedDomains(ctx context.Context, projectID uuid.UUID) ([]string, error) {
	rows, err := q.db.Query(ctx, getProjectTrustedDomains, projectID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []string
	for rows.Next() {
		var domain string
		if err := rows.Scan(&domain); err != nil {
			return nil, err
		}
		items = append(items, domain)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getSessionDetailsByRefreshTokenSHA256 = `-- name: GetSessionDetailsByRefreshTokenSHA256 :one
SELECT
    sessions.id AS session_id,
    users.id AS user_id,
    users.email AS user_email,
    organizations.id AS organization_id,
    organizations.display_name AS organization_display_name,
    organizations.project_id AS project_id,
    sessions.impersonator_user_id
FROM
    sessions
    JOIN users ON sessions.user_id = users.id
    JOIN organizations ON users.organization_id = organizations.id
WHERE
    sessions.refresh_token_sha256 = $1
`

type GetSessionDetailsByRefreshTokenSHA256Row struct {
	SessionID               uuid.UUID
	UserID                  uuid.UUID
	UserEmail               string
	OrganizationID          uuid.UUID
	OrganizationDisplayName string
	ProjectID               uuid.UUID
	ImpersonatorUserID      *uuid.UUID
}

func (q *Queries) GetSessionDetailsByRefreshTokenSHA256(ctx context.Context, refreshTokenSha256 []byte) (GetSessionDetailsByRefreshTokenSHA256Row, error) {
	row := q.db.QueryRow(ctx, getSessionDetailsByRefreshTokenSHA256, refreshTokenSha256)
	var i GetSessionDetailsByRefreshTokenSHA256Row
	err := row.Scan(
		&i.SessionID,
		&i.UserID,
		&i.UserEmail,
		&i.OrganizationID,
		&i.OrganizationDisplayName,
		&i.ProjectID,
		&i.ImpersonatorUserID,
	)
	return i, err
}

const getSessionDetailsByRelayedSessionRefreshTokenSHA256 = `-- name: GetSessionDetailsByRelayedSessionRefreshTokenSHA256 :one
SELECT
    sessions.id AS session_id,
    users.id AS user_id,
    users.email AS user_email,
    organizations.id AS organization_id,
    organizations.display_name AS organization_display_name,
    organizations.project_id AS project_id,
    sessions.impersonator_user_id
FROM
    relayed_sessions
    JOIN sessions ON relayed_sessions.session_id = sessions.id
    JOIN users ON sessions.user_id = users.id
    JOIN organizations ON users.organization_id = organizations.id
WHERE
    relayed_sessions.relayed_refresh_token_sha256 = $1
`

type GetSessionDetailsByRelayedSessionRefreshTokenSHA256Row struct {
	SessionID               uuid.UUID
	UserID                  uuid.UUID
	UserEmail               string
	OrganizationID          uuid.UUID
	OrganizationDisplayName string
	ProjectID               uuid.UUID
	ImpersonatorUserID      *uuid.UUID
}

func (q *Queries) GetSessionDetailsByRelayedSessionRefreshTokenSHA256(ctx context.Context, relayedRefreshTokenSha256 []byte) (GetSessionDetailsByRelayedSessionRefreshTokenSHA256Row, error) {
	row := q.db.QueryRow(ctx, getSessionDetailsByRelayedSessionRefreshTokenSHA256, relayedRefreshTokenSha256)
	var i GetSessionDetailsByRelayedSessionRefreshTokenSHA256Row
	err := row.Scan(
		&i.SessionID,
		&i.UserID,
		&i.UserEmail,
		&i.OrganizationID,
		&i.OrganizationDisplayName,
		&i.ProjectID,
		&i.ImpersonatorUserID,
	)
	return i, err
}
